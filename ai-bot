#!/usr/bin/env python

import configparser
from lib.const import CONFIG_PATH
from lib.datasources.ds_querier import DSQuerier
from lib.datasources.utils import get_datasources
from lib.llm import LLM
from lib.qa_chain import QAChain
from lib.vectorstore import VectorStore


if __name__ == '__main__':
    config = configparser.ConfigParser()
    config.read(CONFIG_PATH)

    llm = LLM(config)
    vector_store = VectorStore(llm)
    datasources = get_datasources(config)
    ds_querier = DSQuerier(vector_store, datasources)
    qa_chain = QAChain(config, llm, ds_querier)

    while True:
        query = input(">")
        # transfer query to lower case
        query = query.lower().strip()
        if query in ['exit', 'quit', 'q', 'e', 'x']:
            break
        if not query:
            continue
        qa_chain.ask(query)
